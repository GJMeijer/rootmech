---
author: "G. J. Meijer"
date: "04/01/2024"
output: html_document
---


## Introduction and disclaimer

This application generates power law fits between root diameter and root strength data, as discussed in the following paper:

> G.J. Meijer. 2024 "TITLE". Plant & Soil x(x):xx-xx. DOI:xxx

This interactive application is intended to make the process of obtaining the best power law fit easy. You can explore the difference between various fitting techniques, both on exisiting data as well as your own user-generated data (select "<user data>" in the "Data" dropdown list on the left, and copy-paste your data in the table.

Please cite the above publication when using the model or its source code. For any question or comments, please contact <gjm36@bath.ac.uk>. Use of the app is at your own risk and does not come with any form of warranty :-)


## Power law curve

The average tensile strength ($t_{r,u}$) of all roots with similar diameters diameter ($d_r$) is assumed to vary with the root diameter according to a power law:

$$ \bar{t}_{r,u} = t_{r,u,0} \left(\frac{d_r}{d_{r,0}}\right)^{\beta_t} $$

where $\beta_t$ is the power coefficient, and $t_{r,u,0}$ the power law multiplier, i.e. the tensile strength of a root with a diameter equal to the reference diameter $d_{r,0}$. It is assumed that $d_{r,0}=1$ mm. 


## Fitting methods

Six different fitting techniques can be employed:

- **Weibull**: the ratio between measured and predicted strength (i.e. $t_{r,u}/\bar{t}_{r,u}$) is assumed to be Weibull distributed with a mean of 1. The Weibull curve is defined by shape parameter $\kappa_t$ and scale parameter $\lambda_t$. The latter follows from the assumption that the mean strength is known, so:
  $$ \lambda_t = \frac{\bar{t}_{r,u}}{\Gamma\left(1 + \frac{1}{\kappa_t}\right)} $$
  
  Meijer (2024) demonstrated this is the usually the best fitting model for fitting root strength power laws.
  
- **NLS (strength)**: Non-linear least-squares regression of tensile strength data. This is the most commonly used method. The residuals (i.e. $t_{r,u} - \bar{t}_{r,u}$) are assumed to the normally distributed with a mean of zero and a standard deviation $\sigma_{t}$ does not change with root diameter:
  $$ \sigma_t = \sigma_{t,0} = \sigma_{t,0} \left(\frac{d_r}{d_{r,0}}\right)^0$$

- **NLS (force)**: Non-linear least-squares regression of root tensile forces at failure $T_{r,u}$. The corresponding power-law is given by:

  $$ \bar{T}_{r,u} = T_{r,u,0} \left(\frac{d_r}{d_{r,0}}\right)^{\beta_T} $$
  The root force $T_{r,u}$ can be calculated from the root cross-sectional area:
  $$ T_{r,u} = \frac{\pi d_r^2}{4} t_{r,u} $$
  and thus fitting parameter $T_{r,u,0}$ and $\beta_T$ can be written in terms of the equivalent root tensile strength power law as:
  $$ t_{r,u,0} = \frac{4}{\pi} T_{r,u} \qquad \beta_t = \beta_T - 2 $$
  
  This fitting method assumes that the residuals ($T_{r,u} - \bar{T}_{r,u}$) are normally distributed. This means that the corresponding standard deviation written in terms of tensile strength satisfies:
  
  $$ \sigma_t = \sigma_{t,0} \left(\frac{d_r}{d_{r,0}}\right)^{-2} $$
  where $\beta_{\sigma,t} = -2$$. The app shows all resuls in terms of tensile strength, rather than forces, in order to aid comparison between the different fitting methods.
  
- **Normally distributed residuals, scaling with mean**: The fitting residuals ($\bar{t}_{r,u} - t_{r,u}$) are assumed normally distributed with a standard deviation that scales with the average strength, i.e. the standard deviation is described by:
  $$ \sigma_t = \sigma_{t,0} \left(\frac{d_r}{d_{r,0}}\right)^{\beta_{t}} $$
  This fit is created by maximising the likelihood function.

- **LS (log-transformed data), without correction**: Linear least-squares regression of log-transformed diameter and tensile strength data. This fitting method assumes that the ratio between measured and predicted strength (i.e. $t_{r,u}/\bar{t}_{r,u}$) is lognormally distributed. This means $\log t_{r,u} - \log \bar{t}{r,u}$ is assumed normally distributed, with a mean $\mu_L = 0$ and a standard deviation $\sigma_L$.  

  The log-transformed power law muliplier $\log t_{r,u,0}$ and the power coefficient $\beta_t$ are found as the intercept and gradient of the best linear fit in log-log space. $\sigma_L$ is the standard deviation of the log-normal distribution. As described by Meijer (2024), this results in an underestimation of predicted tensile strength.

- **LS (log-transformed data), with correction**: As above, but the power law multiplier $t_{r,u,0}$ is adjusted so that it accurately describes the mean of the lognormal distribution, thus accounting for the fact that the mean of a series of log-transformed data is not equal to the log-transformed mean of this data.   Without this correction, the root strength is underestimated, see Meijer (2024) for more details.


## Confidence interval

The confidence interval describes the range in which the best power law fit is located with a certain degree of certainty, usually chosen as 95%. Narrow confidence intervals indicate that the best fit is not stronly affected by variation in the data, and thus is a better fit. 

The chosen level of the confidence interval can be set by the user using the sliders on the left.

Confidence intervals are estimated based the Fisher's information. This matrix is calculated as the negative second derivative of the loglikelihood score ($\log \mathcal{L}$) with respect to the fitting parameters. I.e. then vector $\boldsymbol {p}$ contains all fitting parameters, Fisher's information is calculated as:

$$ \boldsymbol {I}_n = -\frac{\partial^2 \log \mathcal{L}}{\partial \boldsymbol {p}^2} $$

The variance ($var$) for each root diameter $d_r$ is subsequenly estimated using the first-order Delta method:

$$ var \approx \frac{\partial\bar{t}_{r,u}}{\partial\boldsymbol{p}^T} \cdot \boldsymbol{I}_n \cdot \frac{\partial\bar{t}_{r,u}}{\partial\boldsymbol{p}} $$

Finally the confidence interval --- for each diameter --- was determined from the normal distribution, the user-defined confidence level and the calculated variance. for example, the 95% confidence interval is given by:

$$ \bar{t}_{r,u,confidence,min} = \bar{t}_{r,u} - 1.957 \sqrt{var} $$
$$ \bar{t}_{r,u,confidence,max} = \bar{t}_{r,u} + 1.957 \sqrt{var} $$

## Prediction interval

The prediction interval gives the domain that should contain a specified fraction of all newly predicted values for tensile strengths based on the fitted power law fit and parameters describing the intra-diameter variation (e.g. $\kappa_t$, $\sigma_{t,0}$, $\sigma_L$ etc.). Fit types that have prediction intervals nicely enveloping all measured points can be seen as better fits as they better describe the intra-diameter variation.

The chosen level of the prediction interval can be set by the user using the sliders on the left. 

For example, for the 95% prediction interval assuming normally distributed intra-diameter variation, the prediction interval is given by:

$$ \bar{t}_{r,u,prediction,min} = \bar{t}_{r,u} - 1.957 \sigma_t $$
$$ \bar{t}_{r,u,prediction,max} = \bar{t}_{r,u} + 1.957 \sigma_t $$


## Anderson-Darling statistic

The Anderson-Darling test statistic gives an indication of the likelihood that assumed model describing the intra-diameter variation describes this variation well.
